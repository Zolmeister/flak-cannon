(function() {
  var ConversionState, ConversionStore, ExperimentState, ExperimentStore, QueryBuilder, QueryView, RecoilController, RecoilView, ResultStore, ShowState, SparkLine, isPSignificant, nMinusOneChiSquare, pFromZ;

  SparkLine = function(data) {
    var sparkline;
    sparkline = function($el, isInit) {
      var graph, palette;
      if (isInit) {
        return;
      }
      palette = new Rickshaw.Color.Palette();
      graph = new Rickshaw.Graph({
        element: $el,
        width: 100,
        height: 50,
        renderer: 'line',
        series: [
          {
            data: _.map(data, function(datum, i) {
              return {
                x: i,
                y: datum.count
              };
            }),
            color: palette.color()
          }
        ]
      });
      return graph.render();
    };
    return m('div.sparkline', {
      config: sparkline
    });
  };

  nMinusOneChiSquare = function(aConversions, aTotal, bConversions, bTotal) {
    var N, a, b, c, chi2, d, m, n, r, s, z;
    a = aConversions;
    b = aTotal - aConversions;
    c = bConversions;
    d = bConversions - bTotal;
    r = a + c;
    s = b + d;
    m = a + b;
    n = c + d;
    N = m + n + r + s;
    chi2 = Math.pow(a * d - b * c, 2) * (N - 1) / (m * n * r * s);
    z = Math.sqrt(Math.abs(chi2));
    return pFromZ(z);
  };

  pFromZ = function(z) {
    var Z_MAX, w, x, y;
    Z_MAX = 6.0;
    if (z === 0.0) {
      x = 0.0;
    } else {
      y = 0.5 * Math.abs(z);
      if (y > (Z_MAX * 0.5)) {
        x = 1.0;
      } else if (y < 1.0) {
        w = y * y;
        x = ((((((((0.000124818987 * w - 0.001075204047) * w + 0.005198775019) * w - 0.019198292004) * w + 0.059054035642) * w - 0.151968751364) * w + 0.319152932694) * w - 0.531923007300) * w + 0.797884560593) * y * 2.0;
      } else {
        y -= 2.0;
        x = (((((((((((((-0.000045255659 * y + 0.000152529290) * y - 0.000019538132) * y - 0.000676904986) * y + 0.001390604284) * y - 0.000794620820) * y - 0.002034254874) * y + 0.006549791214) * y - 0.010557625006) * y + 0.011630447319) * y - 0.009279453341) * y + 0.005353579108) * y - 0.002141268741) * y + 0.000535310849) * y + 0.999936657524;
      }
    }
    if (z > 0.0) {
      return (x + 1.0) * 0.5;
    } else {
      return (1.0 - x) * 0.5;
    }
  };

  isPSignificant = function(p) {
    return p > 0.05;
  };

  ResultStore = (function() {
    var data, transform;
    transform = function(data) {
      var control;
      data = data.map(function(result) {
        result.totalConversions = _.reduce(result.data, function(sum, datum) {
          return sum + datum.count;
        }, 0);
        return result;
      });
      control = data[0];
      control.p = 0;
      control.percentDelta = 0;
      data = data.slice(1).map(function(result) {
        var aConversions, aPercent, aTotal, bConversions, bPercent, bTotal, p, percentDelta;
        aConversions = result.totalConversions;
        aTotal = result.participantCount;
        bConversions = control.totalConversions;
        bTotal = control.participantCount;
        aPercent = aConversions / aTotal;
        bPercent = bConversions / bTotal;
        percentDelta = aPercent - bPercent;
        p = nMinusOneChiSquare(aConversions, aTotal, bConversions, bTotal);
        result.p = p;
        result.percentDelta = percentDelta;
        return result;
      });
      data = [control].concat(_.sortBy(data, 'percentDelta').reverse());
      return data;
    };
    data = m.request({
      method: 'GET',
      url: '/api/fake/experiments/signupText/results?\nfrom=1/1/14&to=1/30/14&split=Platform,Browser&conversion=signUp'
    });
    return {
      getAll: function() {
        return data.then(transform);
      },
      query: function(q) {
        q = _.defaults(q, {
          experiment: '',
          start: '',
          end: '',
          splits: '',
          conversion: ''
        });
        return m.request({
          method: 'GET',
          url: "/api/fake/experiments/" + q.experiment + "/results\n?from=" + (moment(q.start).format('L')) + "\n&to=" + (moment(q.end).format('L')) + "\n&split=" + q.splits + "\n&conversion=" + q.conversion
        }).then(transform).then(data);
      }
    };
  })();

  QueryBuilder = function(queryHandler) {
    var conversion, end, experiment, query, splits, start;
    experiment = m.prop('signupText');
    start = m.prop(moment().subtract('days', 14).format('L').toString());
    end = m.prop(moment().format('L').toString());
    splits = m.prop('');
    conversion = m.prop('signUp');
    query = function() {
      return queryHandler({
        experiment: experiment(),
        start: start(),
        end: end(),
        splits: splits(),
        conversion: conversion()
      });
    };
    return function() {
      return m('div', [
        m('input', {
          value: experiment(),
          placeholder: 'experiment',
          onchange: m.withAttr('value', experiment)
        }), m('input', {
          value: start(),
          placeholder: 'start',
          onchange: m.withAttr('value', start)
        }), m('input', {
          value: end(),
          placeholder: 'end',
          onchange: m.withAttr('value', end)
        }), m('input', {
          value: splits(),
          placeholder: 'splits (, separated)',
          onchange: m.withAttr('value', splits)
        }), m('input', {
          value: conversion(),
          placeholder: 'conversion',
          onchange: m.withAttr('value', conversion)
        }), m('button', {
          onclick: query
        }, 'go')
      ]);
    };
  };

  ExperimentStore = (function() {
    var data;
    data = m.request({
      method: 'GET',
      url: '/api/fake/experiments'
    });
    return {
      getAll: function() {
        return data;
      }
    };
  })();

  ConversionStore = (function() {
    var data;
    data = m.request({
      method: 'GET',
      url: '/api/fake/conversions/uniq'
    });
    return {
      getAll: function() {
        return data;
      }
    };
  })();

  ExperimentState = function(experiments) {
    return m('ul', experiments.map(function(experiment) {
      return m('li', [
        experiment.name, m('ul', experiment.values.map(function(val) {
          return m('li', val);
        }))
      ]);
    }));
  };

  ConversionState = function(conversions) {
    return m('ul', conversions.map(function(conversion) {
      return m('li', conversion.name);
    }));
  };

  ShowState = function(experiments, conversions) {
    return ['Experiments', ExperimentState(experiments), 'Conversions', ConversionState(conversions)];
  };

  RecoilController = function() {
    return {
      results: ResultStore.getAll(),
      experiments: ExperimentStore.getAll(),
      conversions: ConversionStore.getAll()
    };
  };

  QueryView = QueryBuilder(ResultStore.query);

  RecoilView = function(ctrl) {
    var percent, titles;
    titles = ['test', 'sparkline'].concat(ctrl.results()[0] ? _.keys(ctrl.results()[0].splits) : void 0).concat(['conversions', 'participants', 'percent', 'p', 'delta']);
    percent = function(n) {
      return (n * 100).toFixed(2) + '%';
    };
    return [
      ShowState(ctrl.experiments(), ctrl.conversions()), m('br'), QueryView(), m('br'), m('table', titles.map(m.bind(m, 'th')).concat(_.map(_.values(ctrl.results()), function(result) {
        var color;
        color = result.percentDelta > 0 ? 'green' : result.percentDelta === 0 ? 'black' : 'red';
        return m('tr', [m('td', result.test), m('td', [SparkLine(result.data)])].concat(_.map(_.values(result.splits), m.bind(m, 'td'))).concat([
          m('td', result.totalConversions), m('td', result.participantCount), m('td', percent(result.totalConversions / result.participantCount)), m('td', result.p), m('td', {
            style: {
              color: color
            }
          }, percent(result.percentDelta))
        ]));
      })))
    ];
  };

  m.module(document.getElementById('recoil'), {
    controller: RecoilController,
    view: RecoilView
  });

}).call(this);

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibWFpbi5qcyIsInNvdXJjZXMiOlsibWFpbi5jb2ZmZWUiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7QUFBQSxNQUFBLHdNQUFBOztBQUFBLEVBQUEsU0FBQSxHQUFZLFNBQUMsSUFBRCxHQUFBO0FBQ1YsUUFBQSxTQUFBO0FBQUEsSUFBQSxTQUFBLEdBQVksU0FBQyxHQUFELEVBQU0sTUFBTixHQUFBO0FBQ1YsVUFBQSxjQUFBO0FBQUEsTUFBQSxJQUFHLE1BQUg7QUFDRSxjQUFBLENBREY7T0FBQTtBQUFBLE1BR0EsT0FBQSxHQUFjLElBQUEsUUFBUSxDQUFDLEtBQUssQ0FBQyxPQUFmLENBQUEsQ0FIZCxDQUFBO0FBQUEsTUFJQSxLQUFBLEdBQVksSUFBQSxRQUFRLENBQUMsS0FBVCxDQUNWO0FBQUEsUUFBQSxPQUFBLEVBQVMsR0FBVDtBQUFBLFFBQ0EsS0FBQSxFQUFPLEdBRFA7QUFBQSxRQUVBLE1BQUEsRUFBUSxFQUZSO0FBQUEsUUFHQSxRQUFBLEVBQVUsTUFIVjtBQUFBLFFBSUEsTUFBQSxFQUFRO1VBQ047QUFBQSxZQUFBLElBQUEsRUFBTSxDQUFDLENBQUMsR0FBRixDQUFNLElBQU4sRUFBWSxTQUFDLEtBQUQsRUFBUSxDQUFSLEdBQUE7cUJBQ2hCO0FBQUEsZ0JBQUEsQ0FBQSxFQUFHLENBQUg7QUFBQSxnQkFDQSxDQUFBLEVBQUcsS0FBSyxDQUFDLEtBRFQ7Z0JBRGdCO1lBQUEsQ0FBWixDQUFOO0FBQUEsWUFJQSxLQUFBLEVBQU8sT0FBTyxDQUFDLEtBQVIsQ0FBQSxDQUpQO1dBRE07U0FKUjtPQURVLENBSlosQ0FBQTthQWlCQSxLQUFLLENBQUMsTUFBTixDQUFBLEVBbEJVO0lBQUEsQ0FBWixDQUFBO1dBb0JBLENBQUEsQ0FBRSxlQUFGLEVBQW1CO0FBQUEsTUFBQyxNQUFBLEVBQVEsU0FBVDtLQUFuQixFQXJCVTtFQUFBLENBQVosQ0FBQTs7QUFBQSxFQXdDQSxrQkFBQSxHQUFxQixTQUFDLFlBQUQsRUFBZSxNQUFmLEVBQXVCLFlB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Q0FBUyxRQUFRLENBQUMsY0FBVCxDQUF3QixRQUF4QixDQUFULEVBQ1E7QUFBQSxJQUFDLFVBQUEsRUFBWSxnQkFBYjtBQUFBLElBQStCLElBQUEsRUFBTSxVQUFyQztHQURSLENBN1FBLENBQUE7QUFBQSIsInNvdXJjZXNDb250ZW50IjpbIlNwYXJrTGluZSA9IChkYXRhKSAtPlxuICBzcGFya2xpbmUgPSAoJGVsLCBpc0luaXQpIC0+XG4gICAgaWYgaXNJbml0XG4gICAgICByZXR1cm5cblxuICAgIHBhbGV0dGUgPSBuZXcgUmlja3NoYXcuQ29sb3IuUGFsZXR0ZSgpXG4gICAgZ3JhcGggPSBuZXcgUmlja3NoYXcuR3JhcGhcbiAgICAgIGVsZW1lbnQ6ICRlbFxuICAgICAgd2lkdGg6IDEwMFxuICAgICAgaGVpZ2h0OiA1MFxuICAgICAgcmVuZGVyZXI6ICdsaW5lJ1xuICAgICAgc2VyaWVzOiBbXG4gICAgICAgIGRhdGE6IF8ubWFwKGRhdGEsIChkYXR1bSwgaSkgLT5cbiAgICAgICAgICB4OiBpXG4gICAgICAgICAgeTogZGF0dW0uY291bnRcbiAgICAgICAgKVxuICAgICAgICBjb2xvcjogcGFsZXR0ZS5jb2xvcigpXG4gICAgICBdXG5cbiAgICBncmFwaC5yZW5kZXIoKVxuXG4gIG0gJ2Rpdi5zcGFya2xpbmUnLCB7Y29uZmlnOiBzcGFya2xpbmV9XG5cbiMgRGV0ZXJtaW5lIGlmIHR3byB2YWx1ZXMgYXJlIHN0YXRpc3RpY2FsbHkgZGlmZmVyZW50XG4jIHJldHVybnMgdGhlIHAtdmFsdWVcbiNcbiMgaHR0cDovL3d3dy5pYW5jYW1wYmVsbC5jby51ay90d29ieXR3by9uLTFfdGhlb3J5Lmh0bVxuIyBCIGlzIHN1Y2Nlc3NmdWwgY29udmVyaW9uc1xuIyBub3QtQiBpcyB1bnN1Y2Nlc3NmdWwgY29udmVyc2lvbnNcbiMgQSBpcyB0ZXN0IDFcbiMgbm90LUEgaXMgdGVzdCAyXG4jXG4jIGZvcm11bGFcbiMgKGEqZCAtIGIqYykqKjIgKiAoTiAtMSkgLyAobSpuKnIqcylcbiNcbiMgICAgICAgICAgQiAgbm90LUIgIFRvdGFsXG4jIEEgICAgIHwgIGEgICAgYiAgICAgIG1cbiMgbm90LUEgfCAgYyAgICBkICAgICAgblxuIyBUb3RhbCB8ICByICAgIHMgICAgICBOXG4jXG5uTWludXNPbmVDaGlTcXVhcmUgPSAoYUNvbnZlcnNpb25zLCBhVG90YWwsIGJDb252ZXJzaW9ucywgYlRvdGFsKSAtPlxuICBhID0gYUNvbnZlcnNpb25zXG4gIGIgPSBhVG90YWwgLSBhQ29udmVyc2lvbnNcbiAgYyA9IGJDb252ZXJzaW9uc1xuICBkID0gYkNvbnZlcnNpb25zIC0gYlRvdGFsXG5cbiAgciA9IGEgKyBjXG4gIHMgPSBiICsgZFxuICBtID0gYSArIGJcbiAgbiA9IGMgKyBkXG4gIE4gPSBtICsgbiArIHIgKyBzXG5cbiAgY2hpMiA9IChhKmQgLSBiKmMpKioyICogKE4gLSAxKSAvIChtKm4qcipzKVxuICB6ID0gTWF0aC5zcXJ0KE1hdGguYWJzKGNoaTIpKVxuICBwRnJvbVooeilcblxucEZyb21aID0gKHopIC0+XG4gIFpfTUFYID0gNi4wXG5cbiAgaWYgeiA9PSAwLjBcbiAgICB4ID0gMC4wXG4gIGVsc2VcbiAgICB5ID0gMC41ICogTWF0aC5hYnMoeilcbiAgICBpZiB5ID4gKFpfTUFYICogMC41KVxuICAgICAgeCA9IDEuMFxuICAgIGVsc2UgaWYgeSA8IDEuMFxuICAgICAgdyA9IHkgKiB5XG4gICAgICB4ID0gKCgoKCgoKCgwLjAwMDEyNDgxODk4NyAqIHcgLVxuICAgICAgICAgICAgICAgICAgMC4wMDEwNzUyMDQwNDcpICogdyArIDAuMDA1MTk4Nzc1MDE5KSAqIHcgLVxuICAgICAgICAgICAgICAgICAgMC4wMTkxOTgyOTIwMDQpICogdyArIDAuMDU5MDU0MDM1NjQyKSAqIHcgLVxuICAgICAgICAgICAgICAgICAgMC4xNTE5Njg3NTEzNjQpICogdyArIDAuMzE5MTUyOTMyNjk0KSAqIHcgLVxuICAgICAgICAgICAgICAgICAgMC41MzE5MjMwMDczMDApICogdyArIDAuNzk3ODg0NTYwNTkzKSAqIHkgKiAyLjBcbiAgICBlbHNlXG4gICAgICB5IC09IDIuMFxuICAgICAgeCA9ICgoKCgoKCgoKCgoKCgtMC4wMDAwNDUyNTU2NTkgKiB5ICtcbiAgICAgICAgICAgICAgICAgICAgICAgIDAuMDAwMTUyNTI5MjkwKSAqIHkgLSAwLjAwMDAxOTUzODEzMikgKiB5IC1cbiAgICAgICAgICAgICAgICAgICAgICAgIDAuMDAwNjc2OTA0OTg2KSAqIHkgKyAwLjAwMTM5MDYwNDI4NCkgKiB5IC1cbiAgICAgICAgICAgICAgICAgICAgICAgIDAuMDAwNzk0NjIwODIwKSAqIHkgLSAwLjAwMjAzNDI1NDg3NCkgKiB5ICtcbiAgICAgICAgICAgICAgICAgICAgICAgIDAuMDA2NTQ5NzkxMjE0KSAqIHkgLSAwLjAxMDU1NzYyNTAwNikgKiB5ICtcbiAgICAgICAgICAgICAgICAgICAgICAgIDAuMDExNjMwNDQ3MzE5KSAqIHkgLSAwLjAwOTI3OTQ1MzM0MSkgKiB5ICtcbiAgICAgICAgICAgICAgICAgICAgICAgIDAuMDA1MzUzNTc5MTA4KSAqIHkgLSAwLjAwMjE0MTI2ODc0MSkgKiB5ICtcbiAgICAgICAgICAgICAgICAgICAgICAgIDAuMDAwNTM1MzEwODQ5KSAqIHkgKyAwLjk5OTkzNjY1NzUyNFxuICBpZiB6ID4gMC4wIHRoZW4gKCh4ICsgMS4wKSAqIDAuNSkgZWxzZSAoKDEuMCAtIHgpICogMC41KVxuXG5pc1BTaWduaWZpY2FudCA9IChwKSAtPlxuICBwID4gMC4wNVxuXG5SZXN1bHRTdG9yZSA9IGRvIC0+XG4gIHRyYW5zZm9ybSA9IChkYXRhKSAtPlxuXG4gICAgIyBjb3VudCB0b3RhbCBjb252ZXJzaW9uc1xuICAgIGRhdGEgPSBkYXRhLm1hcCAocmVzdWx0KSAtPlxuICAgICAgcmVzdWx0LnRvdGFsQ29udmVyc2lvbnMgPSBfLnJlZHVjZShyZXN1bHQuZGF0YSwgKHN1bSwgZGF0dW0pIC0+XG4gICAgICAgIHN1bSArIGRhdHVtLmNvdW50XG4gICAgICAsIDApXG4gICAgICByZXR1cm4gcmVzdWx0XG5cbiAgICAjIGNhbGN1bGF0ZSBwLXZhbHVlIGFuZCBwZXJjZW50YWdlIGNoYW5nZSBhZ2FpbnN0IHRoZSBmaXJzdCByZXN1bHRcbiAgICBjb250cm9sID0gZGF0YVswXVxuICAgIGNvbnRyb2wucCA9IDBcbiAgICBjb250cm9sLnBlcmNlbnREZWx0YSA9IDBcblxuICAgIGRhdGEgPSBkYXRhLnNsaWNlKDEpLm1hcCAocmVzdWx0KSAtPlxuICAgICAgYUNvbnZlcnNpb25zID0gcmVzdWx0LnRvdGFsQ29udmVyc2lvbnNcbiAgICAgIGFUb3RhbCA9IHJlc3VsdC5wYXJ0aWNpcGFudENvdW50XG4gICAgICBiQ29udmVyc2lvbnMgPSBjb250cm9sLnRvdGFsQ29udmVyc2lvbnNcbiAgICAgIGJUb3RhbCA9IGNvbnRyb2wucGFydGljaXBhbnRDb3VudFxuXG4gICAgICBhUGVyY2VudCA9IGFDb252ZXJzaW9ucyAvIGFUb3RhbFxuICAgICAgYlBlcmNlbnQgPSBiQ29udmVyc2lvbnMgLyBiVG90YWxcbiAgICAgIHBlcmNlbnREZWx0YSA9IGFQZXJjZW50IC0gYlBlcmNlbnRcblxuICAgICAgcCA9IG5NaW51c09uZUNoaVNxdWFyZShcbiAgICAgICAgYUNvbnZlcnNpb25zLFxuICAgICAgICBhVG90YWwsXG4gICAgICAgIGJDb252ZXJzaW9ucyxcbiAgICAgICAgYlRvdGFsKVxuXG4gICAgICByZXN1bHQucCA9IHBcbiAgICAgIHJlc3VsdC5wZXJjZW50RGVsdGEgPSBwZXJjZW50RGVsdGFcblxuICAgICAgcmV0dXJuIHJlc3VsdFxuXG4gICAgZGF0YSA9IFtjb250cm9sXS5jb25jYXQgXy5zb3J0QnkoZGF0YSwgJ3BlcmNlbnREZWx0YScpLnJldmVyc2UoKVxuICAgIHJldHVybiBkYXRhXG5cbiAgZGF0YSA9IG0ucmVxdWVzdFxuICAgIG1ldGhvZDogJ0dFVCdcbiAgICB1cmw6ICcnJy9hcGkvZmFrZS9leHBlcmltZW50cy9zaWdudXBUZXh0L3Jlc3VsdHM/XG4gICAgICAgICBmcm9tPTEvMS8xNCZ0bz0xLzMwLzE0JnNwbGl0PVBsYXRmb3JtLEJyb3dzZXImY29udmVyc2lvbj1zaWduVXAnJydcblxuICBnZXRBbGw6IC0+XG4gICAgZGF0YS50aGVuKHRyYW5zZm9ybSlcbiAgcXVlcnk6IChxKSAtPlxuICAgIHEgPSBfLmRlZmF1bHRzIHEsXG4gICAgICAgZXhwZXJpbWVudDogJydcbiAgICAgICBzdGFydDogJydcbiAgICAgICBlbmQ6ICcnXG4gICAgICAgc3BsaXRzOiAnJ1xuICAgICAgIGNvbnZlcnNpb246ICcnXG5cbiAgICBtLnJlcXVlc3RcbiAgICAgIG1ldGhvZDogJ0dFVCdcbiAgICAgIHVybDogXCJcIlwiL2FwaS9mYWtlL2V4cGVyaW1lbnRzLyN7cS5leHBlcmltZW50fS9yZXN1bHRzXG4gICAgICA/ZnJvbT0je21vbWVudChxLnN0YXJ0KS5mb3JtYXQoJ0wnKX1cbiAgICAgICZ0bz0je21vbWVudChxLmVuZCkuZm9ybWF0KCdMJyl9XG4gICAgICAmc3BsaXQ9I3txLnNwbGl0c31cbiAgICAgICZjb252ZXJzaW9uPSN7cS5jb252ZXJzaW9ufVwiXCJcIlxuICAgIC50aGVuKHRyYW5zZm9ybSkudGhlbihkYXRhKVxuXG5RdWVyeUJ1aWxkZXIgPSAocXVlcnlIYW5kbGVyKSAtPlxuICBleHBlcmltZW50ID0gbS5wcm9wICdzaWdudXBUZXh0J1xuICBzdGFydCA9IG0ucHJvcCBtb21lbnQoKS5zdWJ0cmFjdCgnZGF5cycsIDE0KS5mb3JtYXQoJ0wnKS50b1N0cmluZygpXG4gIGVuZCA9IG0ucHJvcCBtb21lbnQoKS5mb3JtYXQoJ0wnKS50b1N0cmluZygpXG4gIHNwbGl0cyA9IG0ucHJvcCAnJ1xuICBjb252ZXJzaW9uID0gbS5wcm9wICdzaWduVXAnXG5cbiAgcXVlcnkgPSAtPlxuICAgIHF1ZXJ5SGFuZGxlclxuICAgICAgZXhwZXJpbWVudDogZXhwZXJpbWVudCgpXG4gICAgICBzdGFydDogc3RhcnQoKVxuICAgICAgZW5kOiBlbmQoKVxuICAgICAgc3BsaXRzOiBzcGxpdHMoKSxcbiAgICAgIGNvbnZlcnNpb246IGNvbnZlcnNpb24oKVxuICAtPlxuICAgIG0gJ2RpdicsIFtcbiAgICAgIG0gJ2lucHV0JyxcbiAgICAgICAgdmFsdWU6IGV4cGVyaW1lbnQoKVxuICAgICAgICBwbGFjZWhvbGRlcjogJ2V4cGVyaW1lbnQnXG4gICAgICAgIG9uY2hhbmdlOiBtLndpdGhBdHRyKCd2YWx1ZScsIGV4cGVyaW1lbnQpXG4gICAgICBtICdpbnB1dCcsXG4gICAgICAgIHZhbHVlOiBzdGFydCgpXG4gICAgICAgIHBsYWNlaG9sZGVyOiAnc3RhcnQnXG4gICAgICAgIG9uY2hhbmdlOiBtLndpdGhBdHRyKCd2YWx1ZScsIHN0YXJ0KVxuICAgICAgbSAnaW5wdXQnLFxuICAgICAgICB2YWx1ZTogZW5kKClcbiAgICAgICAgcGxhY2Vob2xkZXI6ICdlbmQnXG4gICAgICAgIG9uY2hhbmdlOiBtLndpdGhBdHRyKCd2YWx1ZScsIGVuZClcbiAgICAgIG0gJ2lucHV0JyxcbiAgICAgICAgdmFsdWU6IHNwbGl0cygpXG4gICAgICAgIHBsYWNlaG9sZGVyOiAnc3BsaXRzICgsIHNlcGFyYXRlZCknXG4gICAgICAgIG9uY2hhbmdlOiBtLndpdGhBdHRyKCd2YWx1ZScsIHNwbGl0cylcbiAgICAgIG0gJ2lucHV0JyxcbiAgICAgICAgdmFsdWU6IGNvbnZlcnNpb24oKVxuICAgICAgICBwbGFjZWhvbGRlcjogJ2NvbnZlcnNpb24nXG4gICAgICAgIG9uY2hhbmdlOiBtLndpdGhBdHRyKCd2YWx1ZScsIGNvbnZlcnNpb24pXG4gICAgICBtICdidXR0b24nLFxuICAgICAgICBvbmNsaWNrOiBxdWVyeSxcbiAgICAgICAgJ2dvJ1xuICAgIF1cblxuRXhwZXJpbWVudFN0b3JlID0gZG8gLT5cbiAgZGF0YSA9IG0ucmVxdWVzdFxuICAgIG1ldGhvZDogJ0dFVCdcbiAgICB1cmw6ICcvYXBpL2Zha2UvZXhwZXJpbWVudHMnXG5cbiAgZ2V0QWxsOiAtPlxuICAgIGRhdGFcblxuQ29udmVyc2lvblN0b3JlID0gZG8gLT5cbiAgZGF0YSA9IG0ucmVxdWVzdFxuICAgIG1ldGhvZDogJ0dFVCdcbiAgICB1cmw6ICcvYXBpL2Zha2UvY29udmVyc2lvbnMvdW5pcSdcblxuICBnZXRBbGw6IC0+XG4gICAgZGF0YVxuXG5FeHBlcmltZW50U3RhdGUgPSAoZXhwZXJpbWVudHMpIC0+XG4gIG0gJ3VsJywgZXhwZXJpbWVudHMubWFwIChleHBlcmltZW50KSAtPlxuICAgIG0gJ2xpJywgW1xuICAgICAgZXhwZXJpbWVudC5uYW1lLFxuICAgICAgbSAndWwnLFxuICAgICAgICBleHBlcmltZW50LnZhbHVlcy5tYXAgKHZhbCkgLT5cbiAgICAgICAgICBtICdsaScsIHZhbFxuICAgIF1cblxuQ29udmVyc2lvblN0YXRlID0gKGNvbnZlcnNpb25zKSAtPlxuICBtICd1bCcsIGNvbnZlcnNpb25zLm1hcCAoY29udmVyc2lvbikgLT5cbiAgICBtICdsaScsIGNvbnZlcnNpb24ubmFtZVxuXG5TaG93U3RhdGUgPSAoZXhwZXJpbWVudHMsIGNvbnZlcnNpb25zKSAtPlxuICBbXG4gICAgJ0V4cGVyaW1lbnRzJyxcbiAgICBFeHBlcmltZW50U3RhdGUoZXhwZXJpbWVudHMpLFxuICAgICdDb252ZXJzaW9ucycsXG4gICAgQ29udmVyc2lvblN0YXRlKGNvbnZlcnNpb25zKVxuICBdXG5cblJlY29pbENvbnRyb2xsZXIgPSAtPlxuICByZXN1bHRzOiBSZXN1bHRTdG9yZS5nZXRBbGwoKVxuICBleHBlcmltZW50czogRXhwZXJpbWVudFN0b3JlLmdldEFsbCgpXG4gIGNvbnZlcnNpb25zOiBDb252ZXJzaW9uU3RvcmUuZ2V0QWxsKClcblxuUXVlcnlWaWV3ID0gUXVlcnlCdWlsZGVyKFJlc3VsdFN0b3JlLnF1ZXJ5KVxuXG5SZWNvaWxWaWV3ID0gKGN0cmwpIC0+XG4gIHRpdGxlcyA9IFsndGVzdCcsICdzcGFya2xpbmUnXVxuICAgIC5jb25jYXQoaWYgY3RybC5yZXN1bHRzKClbMF0gdGhlbiBfLmtleXMoY3RybC5yZXN1bHRzKClbMF0uc3BsaXRzKSlcbiAgICAuY29uY2F0KFsnY29udmVyc2lvbnMnLCAncGFydGljaXBhbnRzJyxcbiAgICAgICAgICAgICAncGVyY2VudCcsICdwJywgJ2RlbHRhJ10pXG5cbiAgcGVyY2VudCA9IChuKSAtPlxuICAgIChuICogMTAwKS50b0ZpeGVkKDIpICsgJyUnXG5cbiAgcmV0dXJuIFtcbiAgICBTaG93U3RhdGUoY3RybC5leHBlcmltZW50cygpLCBjdHJsLmNvbnZlcnNpb25zKCkpXG4gICAgbSAnYnInXG4gICAgUXVlcnlWaWV3KClcbiAgICBtICdicidcbiAgICBtKCd0YWJsZScsIHRpdGxlcy5tYXAobS5iaW5kKG0sICd0aCcpKVxuICAgIC5jb25jYXQoXy5tYXAoXy52YWx1ZXMoY3RybC5yZXN1bHRzKCkpLCAocmVzdWx0KSAtPlxuICAgICAgY29sb3IgPSBpZiByZXN1bHQucGVyY2VudERlbHRhID4gMCB0aGVuICdncmVlbicgZWxzZVxuICAgICAgICAgICAgICBpZiByZXN1bHQucGVyY2VudERlbHRhID09IDAgdGhlbiAnYmxhY2snIGVsc2UgJ3JlZCdcblxuICAgICAgcmV0dXJuIG0oJ3RyJywgW1xuICAgICAgICBtKCd0ZCcsIHJlc3VsdC50ZXN0KSxcbiAgICAgICAgbSgndGQnLCBbU3BhcmtMaW5lKHJlc3VsdC5kYXRhKV0pXG4gICAgICBdXG4gICAgICAuY29uY2F0KF8ubWFwKF8udmFsdWVzKHJlc3VsdC5zcGxpdHMpLCBtLmJpbmQobSwgJ3RkJykgKSlcbiAgICAgIC5jb25jYXQoW1xuICAgICAgICBtICd0ZCcsIHJlc3VsdC50b3RhbENvbnZlcnNpb25zXG4gICAgICAgIG0gJ3RkJywgcmVzdWx0LnBhcnRpY2lwYW50Q291bnRcbiAgICAgICAgbSAndGQnLCBwZXJjZW50IHJlc3VsdC50b3RhbENvbnZlcnNpb25zIC8gcmVzdWx0LnBhcnRpY2lwYW50Q291bnRcbiAgICAgICAgbSAndGQnLCByZXN1bHQucFxuICAgICAgICBtICd0ZCcsIHN0eWxlOiBjb2xvcjogY29sb3IsIHBlcmNlbnQgcmVzdWx0LnBlcmNlbnREZWx0YVxuICAgICAgXSkpXG4gICAgKSkpXG4gIF1cblxubS5tb2R1bGUgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3JlY29pbCcpLFxuICAgICAgICB7Y29udHJvbGxlcjogUmVjb2lsQ29udHJvbGxlciwgdmlldzogUmVjb2lsVmlld31cbiJdLCJzb3VyY2VSb290IjoiL3NvdXJjZS8ifQ==